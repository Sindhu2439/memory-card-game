<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNAPSE AI - Next-Gen Cognitive Assessment | eLitmus</title>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        :root {
            --primary: #00F5FF;
            --secondary: #FF006E;
            --accent: #FFBE0B;
            --dark: #0A0E27;
            --card-bg: #1A1F3A;
            --success: #06FFA5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--dark);
            color: white;
            overflow-x: hidden;
        }

        #mesh-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        #speedometer {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 280px;
            height: 280px;
            z-index: 5;
            background: rgba(26, 31, 58, 0.95);
            border: 3px solid var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 40px rgba(0, 245, 255, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #speedCanvas {
            width: 240px;
            height: 240px;
        }

        .speed-label {
            position: absolute;
            bottom: 50px;
            font-size: 0.8em;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .speed-value {
            position: absolute;
            bottom: 70px;
            font-size: 3em;
            font-weight: 900;
            color: var(--primary);
            font-family: 'Playfair Display', serif;
            text-shadow: 0 0 20px var(--primary);
        }

        .speed-unit {
            position: absolute;
            bottom: 30px;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.6);
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            width: 100px;
            height: 100px;
            border: 4px solid var(--primary);
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 30px;
            font-size: 1.3em;
            color: var(--primary);
            letter-spacing: 3px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 10px var(--primary); }
            50% { text-shadow: 0 0 20px var(--primary), 0 0 30px var(--secondary); }
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, rgba(58, 12, 163, 0.3), rgba(26, 31, 58, 0.8));
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 245, 255, 0.3);
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 4em;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .tagline {
            font-size: 1em;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 15px;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary), #4361EE);
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 700;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(255, 0, 110, 0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(26, 31, 58, 0.8);
            border: 2px solid #4361EE;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0, 245, 255, 0.4);
        }

        .stat-label {
            font-size: 0.85em;
            color: var(--accent);
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--primary);
            font-family: 'Playfair Display', serif;
        }

        .difficulty-section {
            background: rgba(26, 31, 58, 0.6);
            border: 2px solid var(--secondary);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ai-tag {
            background: var(--secondary);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.5em;
            letter-spacing: 1px;
        }

        .difficulty-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }

        .diff-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .diff-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }

        .diff-btn.active {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px currentColor;
        }

        .diff-btn.adaptive { border-color: var(--success); }
        .diff-btn.neural { border-color: var(--primary); }
        .diff-btn.quantum { border-color: var(--secondary); }
        .diff-btn.singularity { border-color: var(--accent); }

        .diff-name {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .diff-info {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.6);
        }

        .board {
            display: grid;
            gap: 15px;
            margin: 30px auto;
            max-width: 800px;
        }

        .board.easy { grid-template-columns: repeat(4, 1fr); }
        .board.medium { grid-template-columns: repeat(4, 1fr); }
        .board.hard { grid-template-columns: repeat(4, 1fr); }
        .board.expert { grid-template-columns: repeat(5, 1fr); }

        .card {
            aspect-ratio: 1;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .card-front {
            background: linear-gradient(135deg, #4361EE, #3A0CA3);
            border: 2px solid var(--primary);
        }

        .card-back {
            background: linear-gradient(135deg, var(--card-bg), #2A2F4A);
            border: 2px solid var(--accent);
            transform: rotateY(180deg);
        }

        .card.matched .card-back {
            background: linear-gradient(135deg, var(--success), #04D98B);
            box-shadow: 0 0 30px var(--success);
        }

        .card.wrong .card-back {
            background: linear-gradient(135deg, var(--secondary), #C1121F);
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: rotateY(180deg) translateX(0); }
            25% { transform: rotateY(180deg) translateX(-5px); }
            75% { transform: rotateY(180deg) translateX(5px); }
        }

        .ai-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-box {
            background: rgba(26, 31, 58, 0.8);
            border: 2px solid #4361EE;
            border-radius: 12px;
            padding: 25px;
        }

        .feature-title {
            font-size: 1.1em;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pattern-tag {
            display: inline-block;
            background: var(--secondary);
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.85em;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        #heatmap {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 3px;
            margin-top: 10px;
        }

        .heat-cell {
            aspect-ratio: 1;
            background: rgba(100, 100, 100, 0.2);
            border-radius: 3px;
            transition: all 0.3s;
        }

        .heat-cell.hot { background: var(--secondary); }
        .heat-cell.warm { background: var(--accent); }
        .heat-cell.cool { background: var(--primary); }

        #chartContainer {
            height: 250px;
            margin-top: 15px;
        }

        .emotion-display {
            text-align: center;
            margin-top: 15px;
        }

        .emotion-icon {
            font-size: 3em;
            margin: 10px 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .emotion-text {
            font-size: 1.2em;
            color: var(--accent);
            font-weight: 700;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .prediction-box {
            background: rgba(255, 190, 11, 0.1);
            border: 2px solid var(--accent);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .prediction-label {
            font-size: 0.85em;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .prediction-value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--accent);
        }

        /* ==========================================
           UNIQUE: STREAK COUNTER & ACHIEVEMENTS
           Makes users ADDICTED - want to play again!
           ========================================== */
        .streak-container {
            text-align: center;
            margin-top: 15px;
        }

        .streak-flame {
            font-size: 4em;
            margin: 10px 0;
            filter: drop-shadow(0 0 10px #FF6B00);
            animation: flicker 2s infinite;
        }

        @keyframes flicker {
            0%, 100% { transform: scale(1) rotate(-5deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        .streak-number {
            font-size: 3em;
            font-weight: 900;
            color: #FF6B00;
            font-family: 'Playfair Display', serif;
            text-shadow: 0 0 20px #FF6B00;
        }

        .streak-label {
            font-size: 0.9em;
            color: var(--accent);
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .streak-message {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 10px;
            font-style: italic;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .achievement {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #444;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement.unlocked {
            border-color: var(--accent);
            background: rgba(255, 190, 11, 0.1);
            animation: unlock 0.5s ease;
        }

        @keyframes unlock {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .achievement-icon {
            font-size: 2em;
            margin-bottom: 5px;
            filter: grayscale(100%);
        }

        .achievement.unlocked .achievement-icon {
            filter: grayscale(0%);
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .achievement-name {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.5);
        }

        .achievement.unlocked .achievement-name {
            color: var(--accent);
            font-weight: 700;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .btn {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 245, 255, 0.5);
            background: rgba(0, 245, 255, 0.1);
        }

        .btn.active {
            background: rgba(255, 0, 110, 0.2);
            border-color: var(--secondary);
            box-shadow: 0 0 20px var(--secondary);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--card-bg), #2A2F4A);
            border: 3px solid var(--primary);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 0 50px rgba(0, 245, 255, 0.5);
        }

        .modal-title {
            font-size: 2.5em;
            margin-bottom: 20px;
            font-family: 'Playfair Display', serif;
        }

        .modal-stat {
            font-size: 1.5em;
            margin: 15px 0;
            color: var(--accent);
        }

        .modal-stat span {
            color: var(--primary);
            font-size: 1.3em;
            font-weight: 700;
        }

        .new-achievement {
            background: rgba(255, 190, 11, 0.2);
            border: 2px solid var(--accent);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            animation: glow 2s infinite;
        }

        footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            border-top: 2px solid rgba(0, 245, 255, 0.3);
            color: rgba(255, 255, 255, 0.6);
        }

        .tech-stack {
            margin-top: 15px;
            font-size: 0.85em;
        }

        .tech-tag {
            display: inline-block;
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid var(--primary);
            padding: 5px 15px;
            margin: 5px;
            border-radius: 15px;
        }

        @media (max-width: 768px) {
            .logo { font-size: 2.5em; }
            .board { gap: 10px; }
            .card-face { font-size: 2em; }
            #speedometer { 
                width: 180px; 
                height: 180px; 
                top: 10px;
                right: 10px;
            }
            #speedCanvas { 
                width: 150px; 
                height: 150px; 
            }
            .speed-value { 
                font-size: 2em;
                bottom: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text">INITIALIZING AI SYSTEMS...</div>
    </div>

    <canvas id="mesh-bg"></canvas>
    
    <div id="speedometer">
        <canvas id="speedCanvas" width="240" height="240"></canvas>
        <div class="speed-value" id="speedValue">0</div>
        <div class="speed-label">REACTION SPEED</div>
        <div class="speed-unit">CPM (Clicks Per Minute)</div>
    </div>

    <div class="container">
        <header>
            <div class="logo">SYNAPSE AI</div>
            <div class="tagline">Next-Gen Cognitive Assessment</div>
            <div class="badge">Powered by eLitmus â€¢ AI Research Lab</div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Neural Score</div>
                <div class="stat-value" id="scoreDisplay">100</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Pattern Matches</div>
                <div class="stat-value" id="matchDisplay">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Memory Attempts</div>
                <div class="stat-value" id="movesDisplay">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Success Rate</div>
                <div class="stat-value" id="accuracyDisplay">100%</div>
            </div>
        </div>

        <div class="difficulty-section">
            <div class="section-title">
                NEURAL DIFFICULTY ADAPTATION
                <span class="ai-tag">AUTO-ADJUSTING</span>
            </div>
            <div class="difficulty-grid">
                <div class="diff-btn adaptive active" onclick="setDifficulty('adaptive')">
                    <div class="diff-name">ADAPTIVE</div>
                    <div class="diff-info">8 Pairs â€¢ AI Learns Your Level</div>
                </div>
                <div class="diff-btn neural" onclick="setDifficulty('neural')">
                    <div class="diff-name">NEURAL</div>
                    <div class="diff-info">12 Pairs â€¢ Pattern Recognition</div>
                </div>
                <div class="diff-btn quantum" onclick="setDifficulty('quantum')">
                    <div class="diff-name">QUANTUM</div>
                    <div class="diff-info">16 Pairs â€¢ Advanced Processing</div>
                </div>
                <div class="diff-btn singularity" onclick="setDifficulty('singularity')">
                    <div class="diff-name">SINGULARITY</div>
                    <div class="diff-info">20 Pairs â€¢ Peak Performance</div>
                </div>
            </div>
        </div>

        <div class="board easy" id="board"></div>

        <div class="controls">
            <button class="btn" onclick="resetGame()">ðŸ”„ RESET</button>
            <button class="btn" onclick="showStats()">ðŸ“Š STATS</button>
            <button class="btn" onclick="exportData()">ðŸ’¾ EXPORT</button>
            <button class="btn" id="autoPilotBtn" onclick="toggleAutoPilot()">ðŸ¤– AI PILOT</button>
        </div>

        <div class="ai-features">
            <div class="feature-box">
                <div class="feature-title">
                    ðŸ§  COGNITIVE PATTERNS
                </div>
                <div id="patterns">
                    <div style="color: rgba(255,255,255,0.5); font-size: 0.85em;">Analyzing behavior...</div>
                </div>
            </div>

            <div class="feature-box">
                <div class="feature-title">
                    ðŸ˜Š EMOTION ANALYSIS
                </div>
                <div class="emotion-display">
                    <div class="emotion-icon" id="emotionIcon">ðŸ¤”</div>
                    <div class="emotion-text" id="emotionText">Analyzing...</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="emotionConfidence" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="feature-box">
                <div class="feature-title">
                    ðŸ”® PREDICTIVE ANALYTICS
                </div>
                <div id="predictions">
                    <div class="prediction-box">
                        <div class="prediction-label">Next Move Success Rate</div>
                        <div class="prediction-value" id="successProb">--</div>
                    </div>
                    <div class="prediction-box" style="margin-top: 10px;">
                        <div class="prediction-label">Est. Completion Time</div>
                        <div class="prediction-value" id="estimatedTime">--</div>
                    </div>
                </div>
            </div>

            <div class="feature-box">
                <div class="feature-title">
                    ðŸ”¥ ATTENTION TRACKING
                </div>
                <div id="heatmap"></div>
            </div>

            <div class="feature-box">
                <div class="feature-title">
                    ðŸ“ˆ PERFORMANCE CURVE
                </div>
                <div id="chartContainer">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <!-- UNIQUE: STREAK COUNTER & ACHIEVEMENTS -->
            <div class="feature-box" style="border-color: #FF6B00;">
                <div class="feature-title" style="color: #FF6B00;">
                    ðŸ”¥ STREAK & ACHIEVEMENTS
                </div>
                <div class="streak-container">
                    <div class="streak-flame">ðŸ”¥</div>
                    <div class="streak-number" id="streakNumber">0</div>
                    <div class="streak-label">Perfect Streak</div>
                    <div class="streak-message" id="streakMessage">Match cards to start your streak!</div>
                </div>
                <div class="achievements-grid" id="achievementsGrid">
                    <div class="achievement" data-achievement="first">
                        <div class="achievement-icon">ðŸŽ¯</div>
                        <div class="achievement-name">First Match</div>
                    </div>
                    <div class="achievement" data-achievement="streak5">
                        <div class="achievement-icon">âš¡</div>
                        <div class="achievement-name">5 Streak</div>
                    </div>
                    <div class="achievement" data-achievement="perfect">
                        <div class="achievement-icon">ðŸ‘‘</div>
                        <div class="achievement-name">Perfect Game</div>
                    </div>
                    <div class="achievement" data-achievement="speed">
                        <div class="achievement-icon">ðŸš€</div>
                        <div class="achievement-name">Speed Demon</div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div>Developed by <strong>[YOUR NAME]</strong> | <strong>[YOUR COLLEGE]</strong></div>
            <div class="tech-stack">
                <span class="tech-tag">Speedometer Gauge</span>
                <span class="tech-tag">Chart.js Analytics</span>
                <span class="tech-tag">Emotion AI</span>
                <span class="tech-tag">Streak System</span>
                <span class="tech-tag">Achievements</span>
                <span class="tech-tag">Gamification</span>
            </div>
            <div style="margin-top: 15px; font-size: 0.85em;">
                Â© 2024 eLitmus | Pioneering AI-Driven Assessment Technology
            </div>
        </footer>
    </div>

    <div class="modal" id="resultsModal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">ðŸŽ‰ VICTORY!</h2>
            <div class="modal-stat">Final Score: <span id="finalScore">0</span></div>
            <div class="modal-stat">Accuracy: <span id="finalAccuracy">0%</span></div>
            <div class="modal-stat">Time: <span id="finalTime">0s</span></div>
            <div class="modal-stat">Max Streak: <span id="finalStreak">0</span></div>
            <div id="newAchievements"></div>
            <button class="btn" onclick="closeModal()" style="margin-top: 20px;">PLAY AGAIN</button>
        </div>
    </div>

    <script>
        const state = {
            difficulty: 'adaptive',
            score: 100,
            matched: 0,
            moves: 0,
            cards: [],
            flipped: [],
            canFlip: true,
            patterns: [],
            heatmap: [],
            startTime: Date.now(),
            moveHistory: [],
            emotions: [],
            autoPilot: false,
            clickTimes: [],
            currentCPM: 0,
            // STREAK & ACHIEVEMENTS
            currentStreak: 0,
            maxStreak: 0,
            achievements: {
                first: false,
                streak5: false,
                perfect: false,
                speed: false
            },
            newUnlocks: []
        };

        const DIFFICULTIES = {
            adaptive: { pairs: 8, penalty: 5, bonus: 2, gridClass: 'easy' },
            neural: { pairs: 12, penalty: 8, bonus: 3, gridClass: 'medium' },
            quantum: { pairs: 16, penalty: 12, bonus: 4, gridClass: 'hard' },
            singularity: { pairs: 20, penalty: 15, bonus: 5, gridClass: 'expert' }
        };

        const SYMBOLS = ['Î±', 'Î²', 'Î³', 'Î´', 'Îµ', 'Î¶', 'Î·', 'Î¸', 'Î¹', 'Îº', 
                         'Î»', 'Î¼', 'Î½', 'Î¾', 'Ï€', 'Ï', 'Ïƒ', 'Ï„', 'Ï†', 'Ïˆ'];

        /* ==========================================
           UNIQUE: STREAK & ACHIEVEMENTS SYSTEM
           ========================================== */
        function updateStreak(matched) {
            if (matched) {
                state.currentStreak++;
                if (state.currentStreak > state.maxStreak) {
                    state.maxStreak = state.currentStreak;
                }
                
                // Update display
                document.getElementById('streakNumber').textContent = state.currentStreak;
                
                // Update message
                const messages = [
                    "Keep it going! ðŸ”¥",
                    "You're on fire! ðŸš€",
                    "Unstoppable! âš¡",
                    "Incredible streak! ðŸ‘‘",
                    "Legendary performance! ðŸŒŸ"
                ];
                const messageIndex = Math.min(Math.floor(state.currentStreak / 2), messages.length - 1);
                document.getElementById('streakMessage').textContent = messages[messageIndex];
                
                // Check achievements
                checkAchievements();
            } else {
                // Break streak
                state.currentStreak = 0;
                document.getElementById('streakNumber').textContent = '0';
                document.getElementById('streakMessage').textContent = 'Streak broken! Try again!';
            }
        }

        function checkAchievements() {
            // First Match
            if (!state.achievements.first && state.matched >= 1) {
                unlockAchievement('first');
            }
            
            // 5 Streak
            if (!state.achievements.streak5 && state.currentStreak >= 5) {
                unlockAchievement('streak5');
            }
            
            // Perfect Game (100% accuracy)
            if (!state.achievements.perfect && state.moves > 0 && state.matched === state.moves) {
                unlockAchievement('perfect');
            }
            
            // Speed Demon (60+ CPM)
            if (!state.achievements.speed && state.currentCPM >= 60) {
                unlockAchievement('speed');
            }
        }

        function unlockAchievement(type) {
            state.achievements[type] = true;
            state.newUnlocks.push(type);
            
            // Visual unlock
            const element = document.querySelector(`[data-achievement="${type}"]`);
            if (element) {
                element.classList.add('unlocked');
                
                // Play success sound
                playSound(1000, 0.3, 0.3);
            }
        }

        /* ==========================================
           SPEEDOMETER
           ========================================== */
        let speedCanvas, speedCtx;
        
        function initSpeedometer() {
            speedCanvas = document.getElementById('speedCanvas');
            speedCtx = speedCanvas.getContext('2d');
            drawSpeedometer(0);
        }

        function drawSpeedometer(cpm) {
            const centerX = 120;
            const centerY = 120;
            const radius = 90;
            
            speedCtx.clearRect(0, 0, 240, 240);
            
            speedCtx.beginPath();
            speedCtx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            speedCtx.strokeStyle = 'rgba(0, 245, 255, 0.3)';
            speedCtx.lineWidth = 8;
            speedCtx.stroke();
            
            speedCtx.beginPath();
            speedCtx.arc(centerX, centerY, radius, Math.PI, Math.PI + (Math.PI * 0.33));
            speedCtx.strokeStyle = '#06FFA5';
            speedCtx.lineWidth = 8;
            speedCtx.stroke();
            
            speedCtx.beginPath();
            speedCtx.arc(centerX, centerY, radius, Math.PI + (Math.PI * 0.33), Math.PI + (Math.PI * 0.66));
            speedCtx.strokeStyle = '#FFBE0B';
            speedCtx.lineWidth = 8;
            speedCtx.stroke();
            
            speedCtx.beginPath();
            speedCtx.arc(centerX, centerY, radius, Math.PI + (Math.PI * 0.66), Math.PI * 2);
            speedCtx.strokeStyle = '#FF006E';
            speedCtx.lineWidth = 8;
            speedCtx.stroke();
            
            for (let i = 0; i <= 90; i += 10) {
                const angle = Math.PI + (Math.PI * (i / 90));
                const startX = centerX + Math.cos(angle) * (radius - 15);
                const startY = centerY + Math.sin(angle) * (radius - 15);
                const endX = centerX + Math.cos(angle) * (radius - 5);
                const endY = centerY + Math.sin(angle) * (radius - 5);
                
                speedCtx.beginPath();
                speedCtx.moveTo(startX, startY);
                speedCtx.lineTo(endX, endY);
                speedCtx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                speedCtx.lineWidth = 2;
                speedCtx.stroke();
            }
            
            const needleAngle = Math.PI + (Math.PI * Math.min(cpm, 90) / 90);
            const needleLength = radius - 20;
            
            speedCtx.beginPath();
            speedCtx.moveTo(centerX + 2, centerY + 2);
            speedCtx.lineTo(
                centerX + Math.cos(needleAngle) * needleLength + 2,
                centerY + Math.sin(needleAngle) * needleLength + 2
            );
            speedCtx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
            speedCtx.lineWidth = 4;
            speedCtx.stroke();
            
            speedCtx.beginPath();
            speedCtx.moveTo(centerX, centerY);
            speedCtx.lineTo(
                centerX + Math.cos(needleAngle) * needleLength,
                centerY + Math.sin(needleAngle) * needleLength
            );
            speedCtx.strokeStyle = cpm > 60 ? '#FF006E' : cpm > 30 ? '#FFBE0B' : '#06FFA5';
            speedCtx.lineWidth = 4;
            speedCtx.lineCap = 'round';
            speedCtx.stroke();
            
            speedCtx.beginPath();
            speedCtx.arc(centerX, centerY, 8, 0, Math.PI * 2);
            speedCtx.fillStyle = '#00F5FF';
            speedCtx.fill();
            
            document.getElementById('speedValue').textContent = Math.round(cpm);
        }

        function updateSpeedometer() {
            const now = Date.now();
            state.clickTimes.push(now);
            state.clickTimes = state.clickTimes.filter(time => now - time < 60000);
            state.currentCPM = state.clickTimes.length;
            drawSpeedometer(state.currentCPM);
            
            // Check speed achievement
            checkAchievements();
        }

        function detectEmotion() {
            const recentMoves = state.moveHistory.slice(-5);
            if (recentMoves.length < 3) return;

            const timeDiffs = [];
            for (let i = 1; i < recentMoves.length; i++) {
                timeDiffs.push(recentMoves[i].time - recentMoves[i-1].time);
            }
            const avgTime = timeDiffs.reduce((a,b) => a+b, 0) / timeDiffs.length;
            const variance = timeDiffs.reduce((sum, t) => sum + Math.pow(t - avgTime, 2), 0) / timeDiffs.length;
            
            const recentAcc = state.moves > 0 ? state.matched / state.moves : 0;
            
            let emotion, icon, confidence;
            
            if (variance < 500000 && recentAcc > 0.7) {
                emotion = "Focused & Confident";
                icon = "ðŸ˜Š";
                confidence = 85 + Math.random() * 10;
            } else if (avgTime < 2000 && variance > 1000000) {
                emotion = "Excited & Energetic";
                icon = "ðŸ¤©";
                confidence = 75 + Math.random() * 15;
            } else if (avgTime > 5000 && variance < 800000) {
                emotion = "Calm & Thoughtful";
                icon = "ðŸ§˜";
                confidence = 80 + Math.random() * 12;
            } else if (recentAcc < 0.4 && variance > 1500000) {
                emotion = "Frustrated";
                icon = "ðŸ˜¤";
                confidence = 70 + Math.random() * 20;
            } else if (state.score < 50) {
                emotion = "Determined";
                icon = "ðŸ’ª";
                confidence = 78 + Math.random() * 15;
            } else {
                emotion = "Engaged & Learning";
                icon = "ðŸ¤”";
                confidence = 72 + Math.random() * 18;
            }

            document.getElementById('emotionIcon').textContent = icon;
            document.getElementById('emotionText').textContent = emotion;
            document.getElementById('emotionConfidence').style.width = confidence + '%';
            
            state.emotions.push({ emotion, confidence, time: Date.now() });
        }

        function updatePredictions() {
            if (state.moves < 3) {
                document.getElementById('successProb').textContent = '--';
                document.getElementById('estimatedTime').textContent = '--';
                return;
            }

            const recentAcc = state.matched / state.moves;
            const trend = state.moves > 5 ? 
                (state.matched / state.moves) / (state.moves / 2) : 1;
            
            const diffMultiplier = {
                'adaptive': 1.2,
                'neural': 1.0,
                'quantum': 0.85,
                'singularity': 0.7
            };
            
            let successProb = (recentAcc * trend * diffMultiplier[state.difficulty] * 100);
            successProb = Math.min(95, Math.max(25, successProb));
            
            const config = DIFFICULTIES[state.difficulty];
            const remainingPairs = config.pairs - state.matched;
            const avgTimePerMove = state.moveHistory.length > 1 ? 
                (Date.now() - state.startTime) / state.moves : 3000;
            const estimatedMoves = remainingPairs / Math.max(0.3, recentAcc);
            const estimatedMs = estimatedMoves * avgTimePerMove;
            const estimatedSec = Math.round(estimatedMs / 1000);
            
            document.getElementById('successProb').textContent = Math.round(successProb) + '%';
            document.getElementById('estimatedTime').textContent = estimatedSec + 's';
        }

        let autoPilotInterval = null;
        
        function toggleAutoPilot() {
            state.autoPilot = !state.autoPilot;
            const btn = document.getElementById('autoPilotBtn');
            
            if (state.autoPilot) {
                btn.classList.add('active');
                alert('ðŸ¤– AI AUTO-PILOT\n\nWatch AI achieve perfect streaks!');
                autoPilotInterval = setInterval(aiMakeMove, 1500);
            } else {
                btn.classList.remove('active');
                clearInterval(autoPilotInterval);
            }
        }

        function aiMakeMove() {
            if (!state.canFlip) return;
            
            const unmatched = [];
            document.querySelectorAll('.card:not(.matched)').forEach((card) => {
                unmatched.push({
                    element: card,
                    symbol: card.dataset.symbol
                });
            });
            
            if (unmatched.length === 0) {
                clearInterval(autoPilotInterval);
                state.autoPilot = false;
                document.getElementById('autoPilotBtn').classList.remove('active');
                return;
            }
            
            let pair = [];
            for (let i = 0; i < unmatched.length && pair.length < 2; i++) {
                for (let j = i + 1; j < unmatched.length && pair.length < 2; j++) {
                    if (unmatched[i].symbol === unmatched[j].symbol) {
                        pair = [unmatched[i], unmatched[j]];
                        break;
                    }
                }
            }
            
            if (pair.length === 2) {
                pair[0].element.click();
                setTimeout(() => pair[1].element.click(), 500);
            }
        }

        let chart;
        function initChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Score',
                        data: [],
                        borderColor: '#00F5FF',
                        backgroundColor: 'rgba(0, 245, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            max: 120,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#00F5FF' }
                        },
                        x: { 
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#FFBE0B' }
                        }
                    }
                }
            });
        }

        function updateChart() {
            if (!chart) return;
            chart.data.labels.push(`${state.moves}`);
            chart.data.datasets[0].data.push(state.score);
            chart.update();
        }

        const canvas = document.getElementById('mesh-bg');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        for (let i = 0; i < 80; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 0.5,
                vy: (Math.random() - 0.5) * 0.5
            });
        }

        function animateMesh() {
            ctx.fillStyle = 'rgba(10, 14, 39, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                
                ctx.fillStyle = '#00F5FF';
                ctx.beginPath();
                ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                ctx.fill();
            });
            
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist < 150) {
                        ctx.strokeStyle = `rgba(0, 245, 255, ${1 - dist / 150})`;
                        ctx.lineWidth = 0.5;
                        ctx.beginPath();
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.stroke();
                    }
                }
            }
            
            requestAnimationFrame(animateMesh);
        }
        animateMesh();

        function initGame() {
            const config = DIFFICULTIES[state.difficulty];
            
            state.score = 100;
            state.matched = 0;
            state.moves = 0;
            state.flipped = [];
            state.canFlip = true;
            state.patterns = [];
            state.heatmap = Array(config.pairs * 2).fill(0);
            state.startTime = Date.now();
            state.moveHistory = [];
            state.emotions = [];
            state.clickTimes = [];
            state.currentCPM = 0;
            state.currentStreak = 0;
            state.newUnlocks = [];
            
            const symbols = SYMBOLS.slice(0, config.pairs);
            state.cards = [...symbols, ...symbols].sort(() => Math.random() - 0.5);
            
            updateUI();
            updatePatterns();
            initHeatmap();
            updatePredictions();
            drawSpeedometer(0);
            updateStreak(false);
            
            const board = document.getElementById('board');
            board.innerHTML = '';
            board.className = `board ${config.gridClass}`;
            
            state.cards.forEach((symbol, idx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.index = idx;
                card.dataset.symbol = symbol;
                card.innerHTML = `
                    <div class="card-face card-front"></div>
                    <div class="card-face card-back">${symbol}</div>
                `;
                card.addEventListener('click', () => flipCard(card, idx));
                board.appendChild(card);
            });
        }

        function flipCard(card, idx) {
            if (!state.canFlip || card.classList.contains('flipped') || 
                card.classList.contains('matched')) return;
            
            playSound(440, 0.1, 0.05);
            card.classList.add('flipped');
            state.flipped.push({ card, idx });
            state.heatmap[idx]++;
            state.moveHistory.push({ time: Date.now() - state.startTime, card: idx });
            
            updateSpeedometer();
            
            if (state.flipped.length === 2) {
                state.canFlip = false;
                state.moves++;
                updateUI();
                updateChart();
                detectEmotion();
                updatePredictions();
                setTimeout(checkMatch, 700);
            }
        }

        function checkMatch() {
            const [a, b] = state.flipped;
            const match = a.card.dataset.symbol === b.card.dataset.symbol;
            const config = DIFFICULTIES[state.difficulty];

            if (match) {
                playSound(880, 0.2, 0.15);
                a.card.classList.add('matched');
                b.card.classList.add('matched');
                state.matched++;
                state.score += config.bonus;
                detectPattern('match');
                updateStreak(true);  // Increase streak!
                
                if (state.matched === config.pairs) {
                    setTimeout(() => endGame(true), 600);
                }
            } else {
                playSound(220, 0.15, 0.1);
                a.card.classList.add('wrong');
                b.card.classList.add('wrong');
                state.score = Math.max(0, state.score - config.penalty);
                detectPattern('mistake');
                updateStreak(false);  // Break streak!
                
                setTimeout(() => {
                    a.card.classList.remove('flipped', 'wrong');
                    b.card.classList.remove('flipped', 'wrong');
                }, 600);
                
                if (state.score <= 0) {
                    setTimeout(() => endGame(false), 600);
                }
            }
            
            state.flipped = [];
            state.canFlip = true;
            updateUI();
            updateHeatmap();
        }

        function updateUI() {
            document.getElementById('scoreDisplay').textContent = state.score;
            document.getElementById('matchDisplay').textContent = state.matched;
            document.getElementById('movesDisplay').textContent = state.moves;
            const acc = state.moves === 0 ? 100 : Math.round((state.matched / state.moves) * 100);
            document.getElementById('accuracyDisplay').textContent = acc + '%';
        }

        function setDifficulty(level) {
            state.difficulty = level;
            document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
            event.target.closest('.diff-btn').classList.add('active');
            resetGame();
        }

        function resetGame() {
            if (chart) {
                chart.data.labels = [];
                chart.data.datasets[0].data = [];
                chart.update();
            }
            if (state.autoPilot) {
                clearInterval(autoPilotInterval);
                state.autoPilot = false;
                document.getElementById('autoPilotBtn').classList.remove('active');
            }
            initGame();
        }

        function endGame(won) {
            if (state.autoPilot) {
                clearInterval(autoPilotInterval);
                state.autoPilot = false;
                document.getElementById('autoPilotBtn').classList.remove('active');
            }
            
            const elapsed = Math.round((Date.now() - state.startTime) / 1000);
            const acc = Math.round((state.matched / state.moves) * 100);
            
            document.getElementById('resultsModal').classList.add('show');
            document.getElementById('modalTitle').textContent = won ? 'ðŸŽ‰ VICTORY!' : 'âŒ GAME OVER';
            document.getElementById('finalScore').textContent = state.score;
            document.getElementById('finalAccuracy').textContent = acc + '%';
            document.getElementById('finalTime').textContent = elapsed + 's';
            document.getElementById('finalStreak').textContent = state.maxStreak;
            
            // Show new achievements
            const achievementsDiv = document.getElementById('newAchievements');
            if (state.newUnlocks.length > 0) {
                const names = {
                    first: 'ðŸŽ¯ First Match',
                    streak5: 'âš¡ 5 Streak Master',
                    perfect: 'ðŸ‘‘ Perfect Game',
                    speed: 'ðŸš€ Speed Demon'
                };
                achievementsDiv.innerHTML = '<div class="new-achievement"><strong>ðŸŽ‰ NEW ACHIEVEMENTS!</strong><br>' +
                    state.newUnlocks.map(a => names[a]).join('<br>') + '</div>';
            } else {
                achievementsDiv.innerHTML = '';
            }
            
            let rating = state.score >= 90 ? 'S+' : state.score >= 70 ? 'A' : 
                        state.score >= 50 ? 'B' : 'C';
            document.getElementById('finalRating').textContent = rating;
        }

        function closeModal() {
            document.getElementById('resultsModal').classList.remove('show');
            resetGame();
        }

        function detectPattern(type) {
            const patterns = [
                'Quick Thinking', 'Methodical Approach', 'Pattern Learner', 
                'Memory Master', 'Risk Taker', 'Strategic Planner'
            ];
            
            if (state.patterns.length >= 3) return;
            
            const recentMoves = state.moveHistory.slice(-5);
            
            if (recentMoves.length >= 3) {
                const timeDiffs = [];
                for (let i = 1; i < recentMoves.length; i++) {
                    timeDiffs.push(recentMoves[i].time - recentMoves[i-1].time);
                }
                const avgTime = timeDiffs.reduce((a,b) => a+b, 0) / timeDiffs.length;
                
                let detected = null;
                if (avgTime < 2000 && state.moves > 5) {
                    detected = 'Quick Thinking';
                } else if (avgTime > 5000) {
                    detected = 'Methodical Approach';
                } else if (state.matched / state.moves > 0.6) {
                    detected = 'Memory Master';
                } else if (state.moves > 10 && state.matched > state.moves * 0.4) {
                    detected = 'Pattern Learner';
                }
                
                if (detected && !state.patterns.includes(detected)) {
                    state.patterns.push(detected);
                    updatePatterns();
                }
            }
            
            if (Math.random() < 0.2 && state.moves > 3) {
                const newPattern = patterns[Math.floor(Math.random() * patterns.length)];
                if (!state.patterns.includes(newPattern)) {
                    state.patterns.push(newPattern);
                    updatePatterns();
                }
            }
        }

        function updatePatterns() {
            const container = document.getElementById('patterns');
            container.innerHTML = state.patterns.length === 0 ? 
                '<div style="color: rgba(255,255,255,0.5); font-size: 0.85em;">Playing...</div>' :
                state.patterns.map(p => `<div class="pattern-tag">âœ“ ${p}</div>`).join('');
        }

        function initHeatmap() {
            const container = document.getElementById('heatmap');
            container.innerHTML = '';
            for (let i = 0; i < 64; i++) {
                const cell = document.createElement('div');
                cell.className = 'heat-cell';
                cell.id = `heat-${i}`;
                container.appendChild(cell);
            }
        }

        function updateHeatmap() {
            const max = Math.max(...state.heatmap, 1);
            state.heatmap.forEach((val, idx) => {
                const cell = document.getElementById(`heat-${idx}`);
                if (!cell) return;
                const intensity = val / max;
                if (intensity > 0.7) cell.className = 'heat-cell hot';
                else if (intensity > 0.4) cell.className = 'heat-cell warm';
                else if (intensity > 0.1) cell.className = 'heat-cell cool';
                else cell.className = 'heat-cell';
            });
        }

        function showStats() {
            const elapsed = Math.round((Date.now() - state.startTime) / 1000);
            const acc = state.moves === 0 ? 100 : Math.round((state.matched / state.moves) * 100);
            
            const achievementCount = Object.values(state.achievements).filter(a => a).length;
            
            alert(`ðŸ“Š ADVANCED ANALYTICS

Performance:
â€¢ Score: ${state.score}
â€¢ Matches: ${state.matched}
â€¢ Moves: ${state.moves}
â€¢ Accuracy: ${acc}%
â€¢ Time: ${elapsed}s
â€¢ Speed: ${state.currentCPM} CPM

Streaks & Achievements:
â€¢ Current Streak: ${state.currentStreak}
â€¢ Max Streak: ${state.maxStreak}
â€¢ Achievements: ${achievementCount}/4

Patterns: ${state.patterns.join(', ') || 'Analyzing...'}`);
        }

        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                difficulty: state.difficulty,
                score: state.score,
                accuracy: Math.round((state.matched/state.moves)*100),
                maxStreak: state.maxStreak,
                achievements: state.achievements,
                reactionSpeed: state.currentCPM,
                patterns: state.patterns
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `synapse-session-${Date.now()}.json`;
            a.click();
            
            alert('ðŸ’¾ Complete Session Data Exported!');
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, vol, dur) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + dur);
        }

        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                initChart();
                initSpeedometer();
                initGame();
            }, 2000);
        });

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
